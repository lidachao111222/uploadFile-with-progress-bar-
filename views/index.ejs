<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="/node_modules/bootstrap/dist/css/bootstrap.css">
    <style>
        .progress {
            height: 2rem;
            font-size: 1.5rem;
            display: none;
            margin-top: 20px;
        }

        body {
            padding: 0 30px 0 30px;

        }

        button {
            margin-top: 20px;

        }

        .alert-secondary {
            margin-top: 1px;
        }

        #exampleFormControlFile1 {
            display: none;
        }

        img{
           width: 80px;
           height: 80px;
        }

        #add{
            font-size: 12px;
            margin-top: -5px;
        }
    </style>



    <title>文件上传</title>
</head>

<body>

    <div class="alert alert-secondary" role="alert">
        欢迎使用文件上传系统
    </div>


    <form>
        <div class="form-group">
            <label for="exampleFormControlFile1">
                
                <img src="/node_modules/upload.png" alt="">
            </label>
            <p id="add">点击图标添加图片</p>
            <input type="file" class="form-control-file" id="exampleFormControlFile1">
        </div>
    </form>


    <div class="progress">
        <div class="progress-bar progress-bar-striped " role="progressbar" aria-valuenow="75" aria-valuemin="0"
            aria-valuemax="100" style="width: 90%">10</div>
    </div>


</body>

<!-- 引用js -->

<script src="/node_modules/jquery/dist/jquery.js"></script>
<script src="/node_modules/bootstrap/dist/js/bootstrap.js"></script>


<script>
    //入口函数
    $(function () {


        $('#exampleFormControlFile1').on('change',function(){

            //得到文件
            // console.dir(this.files[0]);

            let img =  this.files[0];

            let fd = new FormData();

            fd.append('imgSend',img);

            console.log(fd.get('imgSend'))
            //ajax post请求
            $.post({
                url:'/addPic',
                data:fd,

                processData:false,
                contentType:false,

                success:function(res){

                },

                //要在jq里面给xhr注册事件，jq需要我们提供一个xhr对象
                xhr: function(){
                    let xhr = new XMLHttpRequest();

                    // 给xhr注册process事件
                    xhr.upload.onprogress = function(e){
             
                        let load = e.loaded;
                        let total = e.total;
                        console.log(Math.floor((load/total)*100));

                        //得到进度
                        let current = Math.floor((load/total)*100);

                        //进度条完成
                        $('.progress-bar-striped').css('width',`${current}%`);
                        $('.progress-bar-striped').html(`${current}%`);
                    }

                    return xhr;
                },
                //事件
                beforeSend:function(){
                    $('.progress-bar-striped').toggleClass('progress-bar-animated');
                    $('.progress').toggle('display', '');
                }

                

                
            })
        })

        //注册事件
        // $('button').on('click', function () {
        //     $('.progress-bar-striped').toggleClass('progress-bar-animated');
        //     $('.progress').toggle('display', '');
        // })


    })
</script>

</html>