<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="/node_modules/bootstrap/dist/css/bootstrap.css">
    <style>
        .progress {
            height: 2rem;
            font-size: 1.5rem;
            display: none;
            /* margin-top: 20px; */
        }

        body {
            padding: 0 30px 0 30px;

        }

        button {
            margin-top: 20px;

        }

        .alert-secondary {
            margin-top: 1px;
        }

        #exampleFormControlFile1 {
            display: none;
        }

        img {
            width: 100px;
            height: 100px;
        }

        #add {
            font-size: 12px;
            margin-top: -5px;
        }


        #exampleModal{
            margin-top: 300px;
        }
    </style>



    <title>æ–‡ä»¶ä¸Šä¼ </title>
</head>

<body>

    <div class="alert alert-secondary" role="alert">
        æ¬¢è¿ä½¿ç”¨ç§å­ä¸Šä¼ ç³»ç»Ÿ
    </div>

    <!-- æ·»åŠ å›¾ç‰‡æŒ‰é’® -->
    <form>
        <div class="form-group">
            <label for="exampleFormControlFile1">
                <img src="/node_modules/upload.png" alt="">
            </label>
            <p id="add">ç‚¹å‡»å›¾æ ‡æ·»åŠ å›¾ç‰‡</p>
            <input type="file" class="form-control-file" id="exampleFormControlFile1">
        </div>
    </form>


    <button type="button" class="btn btn-warning">ç‚¹å‡»è¿›å…¥æµè§ˆé¡µ(18ğŸ”¥)</button>

    <!-- è¿›åº¦æ¡ -->
    <div class="progress">
        <div class="progress-bar progress-bar-striped " role="progressbar" aria-valuenow="75" aria-valuemin="0"
            aria-valuemax="100" style="width: 90%">10</div>
    </div>


    <!-- Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">æç¤º</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    ä¸Šä¼ æˆåŠŸ
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">å…³é—­</button>
                </div>
            </div>
        </div>
    </div>

</body>

<!-- å¼•ç”¨js -->

<script src="/node_modules/jquery/dist/jquery.js"></script>
<script src="/node_modules/bootstrap/dist/js/bootstrap.js"></script>


<script>
    //å…¥å£å‡½æ•°
    $(function () {


        $('#exampleFormControlFile1').on('change', function () {

            //å¾—åˆ°æ–‡ä»¶
            // console.dir(this.files[0]);

            let img = this.files[0];

            let fd = new FormData();

            fd.append('imgSend', img);

            // console.log(fd.get('imgSend'))
            //ajax postè¯·æ±‚
            $.post({
                url: '/addPic',
                data: fd,

                processData: false,
                contentType: false,

                success: function (res) {

                    if (res.code == 200) {

                        console.log(res);

                        $('#exampleModal').modal();

                    }
                },

                //è¦åœ¨jqé‡Œé¢ç»™xhræ³¨å†Œäº‹ä»¶ï¼Œjqéœ€è¦æˆ‘ä»¬æä¾›ä¸€ä¸ªxhrå¯¹è±¡
                xhr: function () {
                    let xhr = new XMLHttpRequest();

                    // ç»™xhræ³¨å†Œprocessäº‹ä»¶
                    xhr.upload.onprogress = function (e) {

                        let load = e.loaded;
                        let total = e.total;
                        // console.log(Math.floor((load/total)*100));

                        //å¾—åˆ°è¿›åº¦
                        let current = Math.floor((load / total) * 100);

                        //è¿›åº¦æ¡å®Œæˆ
                        $('.progress-bar-striped').css('width', `${current}%`);
                        $('.progress-bar-striped').html(`${current}%`);
                    }

                    return xhr;
                },
                //äº‹ä»¶
                beforeSend: function () {
                    $('.progress-bar-striped').toggleClass('progress-bar-animated');
                    $('.progress').toggle('display', '');
                }




            })
        })


        //ç»™å…³é—­æ³¨å†Œä¸€ä¸ªäº‹ä»¶
        
        $('.btn-secondary').on('click',function(){

            //å½±è—è¿›åº¦æ¡
            $('.progress').css('display', 'none');

            //å½±è—æ¨¡æ€æ¡†
            $('#exampleModal').modal('hide');

            location.reload();   //ä¸ºä»€ä¹ˆä¸èƒ½é‡å¤æ“ä½œï¼Œå¿…é¡»è¦reloadå‘¢ï¼Ÿ

        })
     


    })
</script>

</html>